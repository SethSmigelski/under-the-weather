function displayWeather(e,n){const{style_set:t,display_mode:a,forecast_days:s,show_details:r,show_timestamp:o,show_unit:i}=under_the_weather_settings,d=n.dataset.locationName||"",c="Â°",l="metric"===e.units?"C":"F",h="metric"===e.units?"kph":"mph",u=i?`<span class="temp-unit">${l}</span>`:"";function p(e){return"weather_icons_font"===t?`<i class="wi ${e.icon_class}"></i>`:`<img src="${under_the_weather_plugin_url.url}images/default-weather-images-${e.icon}.png" alt="${e.description}">`}let w="";if("today_forecast"===a){const n=e.daily[0],t=Math.round(n.temp.max),a=Math.round(n.temp.min);w=`<div class="current-weather"><div class="today-forecast-temps"><div class="today-forecast-label">Today</div><div class="temps-wrapper"><span class="high">${t}${c}</span> / <span class="low">${a}${c}</span>${u}</div></div><div class="current-conditions">${p(n.weather[0])}<span>${n.weather[0].description}</span></div></div>`}else{const n=e.current;w=`<div class="current-weather"><div class="current-temp">${Math.round(n.temp)}${c}${u}</div><div class="current-conditions">${p(n.weather[0])}<span>${n.weather[0].description}</span></div></div>`}let $="";if(r){const n=Math.round(e.current.feels_like),t=Math.round(e.current.wind_speed),a=(m=e.current.wind_deg,["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(m/22.5)%16]),s=function(e){return`wi wi-wind from-${Math.round(e)}-deg`}(e.current.wind_deg);$=`<div class="weather-extra-details"><span>Feels like: ${n}${c}${u}</span><span class="wind-details"><i class="${s}"></i> ${a} ${t} ${h}</span></div>`}var m;const v=parseInt(s,10)||5,f=e.daily.slice(1,1+v);let _="";f.forEach(e=>{const n=new Date(1e3*e.dt).toLocaleDateString("en-US",{weekday:"short"}),t=Math.round(e.temp.max),a=Math.round(e.temp.min);_+=`<div class="forecast-day"><div class="forecast-day-name">${n}</div>${p(e.weather[0])}<div class="forecast-temps"><span class="high">${t}${c}</span> / <span class="low">${a}${c}</span></div></div>`});let g="";o&&e.fetched_at&&(g=`<div class="last-updated">Updated ${function(e){const n=(new Date).getTime()/1e3,t=Math.floor(n-e);if(t<60)return"just now";let a=t/31536e3;return a>1?Math.floor(a)+" years ago":(a=t/2592e3,a>1?Math.floor(a)+" months ago":(a=t/86400,a>1?Math.floor(a)+" days ago":(a=t/3600,a>1?Math.floor(a)+" hours ago":(a=t/60,a>1?Math.floor(a)+" minutes ago":"a minute ago"))))}(e.fetched_at)}</div>`);const M=`<div class="weather-location-name">${d}</div>${w}${$}<div class="forecast-container">${_}</div>${g}`;n.innerHTML=M}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".weather-widget");if(!e)return;const n=e.dataset.lat,t=e.dataset.lon,a=e.dataset.locationName,s=e.dataset.unit?e.dataset.unit.toLowerCase():"imperial";if(!n||!t||!a)return void(e.innerHTML="Location data is missing.");const r=`/wp-json/under-the-weather/v1/forecast?lat=${n}&lon=${t}&location_name=${encodeURIComponent(a)}&unit=${s}`;fetch(r).then(n=>{if(!n.ok)throw n.text().then(n=>{console.error("Error fetching weather data:",n),e.innerHTML="<p>Could not retrieve forecast. Server error.</p>"}),new Error("Network response was not ok");return n.json()}).then(n=>{displayWeather(n,e)}).catch(e=>{console.error("Network Error:",e)})});